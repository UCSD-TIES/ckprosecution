{% extends "base.html" %}

{% block title %}Coastkeeper: Report Database and Analytics{% endblock %}

{% block htmlhead %}
    <link rel="stylesheet" href="{{ STATIC_URL }}coastkeeper/css/datepicker3.css" />
    <script type="text/javascript" src="{{ STATIC_URL }}coastkeeper/JS/json2.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}coastkeeper/JS/bootstrap-datepicker3.js"></script> 
    
    <style>
        .createtable {text-align:left;}
        .button { margin: 4px 10px; }
        .line { border-bottom: 1px solid black; }
        .close { float: right; }
        .notice { color: #F4811F; padding-top: 25px; }
        .newlook {background-color:white;}
        .actions {margin-left:10px;}
        .actions { margin-bottom: 15px; }
        .title {margin-left: 10px;margin-top: 25px;margin-bottom:25px; font-size:2em;}
    </style>
{% endblock %}

{% block header %}
    <div class="header-bottom">
        <div class="container">
            <span class="right">
                <form action="/reports/search/" method="get">
                    {% csrf_token %}
                    <input name="q" type="text" class="input-medium search-query" placeholder="Search reports">
                    <button type="submit" value="Submit" class="btn btn-info"><i class="icon-search"></i>&nbsp&nbspSearch</button>
                </form>
            </span>
            <span class="left">
                <form action="/reports/filter_by_date/" method="get" class="form-inline">
                    {% csrf_token %}
                    <label>From</label>
                    <input name="start_date" type="text" id="datepicker_start">
                    <label>To</label>
                    <input name="end_date" type="text" id="datepicker_end">
                    <button type="submit" value="Submit" class="btn btn-info"><i class="icon-filter"></i>&nbsp&nbspFilter by Date</button>
                </form>
            </span>
        </div>
    </div>
{% endblock %}

{% block content %}
    <div class="title">
        Reports
    </div>

    {% block actions %}
    {% if user.is_authenticated %}
        <div class="actions">
            <a href="#create_report" data-target="#create_report" data-toggle="modal" class="btn btn-primary"><i class="icon-plus-sign icon-large"></i>&nbsp&nbspNew Report</a>
        </div>
    {% endif %}
    {% endblock %}

    <div class="reporttable">
	<table class="table" id="expenselist">
            <thead>
                <tr>
                    <th>Crime Date<a href="{% url rank rank_by='crime_date' reverse='true' %}"><i class="icon-arrow-up"></i></a><a href="{% url rank rank_by='crime_date' reverse='false' %}"><i class="icon-arrow-down"></i></a></th>
                    <th>Resolve Days<a href="{% url rank rank_by='resolve_days' reverse='true' %}"><i class="icon-arrow-up"></i></a><a href="{% url rank rank_by='resolve_days' reverse='false' %}"><i class="icon-arrow-down"></i></a></th>
                    <th>Suspects<a href="{% url rank rank_by='num_involved' reverse='true' %}"><i class="icon-arrow-up"></i></a><a href="{% url rank rank_by='num_involved' reverse='false' %}"><i class="icon-arrow-down"></i></a></th>
                    <th>Creature<a href="{% url rank rank_by='creature' reverse='true' %}"><i class="icon-arrow-up"></i></a><a href="{% url rank rank_by='creature' reverse='false' %}"><i class="icon-arrow-down"></i></a></th>
                    <th>Location<a href="{% url rank rank_by='location' reverse='true' %}"><i class="icon-arrow-up"></i></a><a href="{% url rank rank_by='location' reverse='false' %}"><i class="icon-arrow-down"></i></a></th>
                    <th>Trial Location<a href="{% url rank rank_by='trial_location' reverse='true' %}"><i class="icon-arrow-up"></i></a><a href="{% url rank rank_by='trial_location' reverse='false' %}"><i class="icon-arrow-down"></i></a></th>
                    <th>Fine<a href="{% url rank rank_by='fine' reverse='true' %}"><i class="icon-arrow-up"></i></a><a href="{% url rank rank_by='fine' reverse='false' %}"><i class="icon-arrow-down"></i></a></th>
                    <th>Jail<a href="{% url rank rank_by='jail_time' reverse='true' %}"><i class="icon-arrow-up"></i></a><a href="{% url rank rank_by='jail_time' reverse='false' %}"><i class="icon-arrow-down"></i></a></th>
                    <th>MPA<a href="{% url rank rank_by='mpa' reverse='true' %}"><i class="icon-arrow-up"></i></a><a href="{% url rank rank_by='mpa' reverse='false' %}"><i class="icon-arrow-down"></i></a></th>
                    <th>Update Date<a href="{% url rank rank_by='update_date' reverse='true' %}"><i class="icon-arrow-up"></i></a><a href="{% url rank rank_by='update_date' reverse='false' %}"><i class="icon-arrow-down"></i></a></th>
                    <th> </th>
                </tr>
            </thead>
            <tbody id="table_body">
		{% for item in reports %}
                    <tr id="{{ item.id }}">
                        <td>{{ item.crime_date }}</td>
                        <td>{{ item.resolve_days }}</td>
                        <td>{{ item.num_involved }}</td>
                        <td>{{ item.creature }}</td>
                        <td>{{ item.location }}</td>
                        <td>{{ item.trial_location }}</td>
                        <td>{{ item.fine }}</td>
                        <td>{{ item.jail_time }}</td>
                        <td>{{ item.mpa }}</td>
                        <td>{{ item.update_date }}</td>
                        <td><a href="{% url detail report_id=item.id %}">Details</a></td>
                    </tr>
		{% endfor %}
	    </tbody>
	</table>
    </div>

    <div id="create_report" class="modal hide fade">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h3>Create New Report</h3>
        </div>
        <div class="modal-body">
            <form action="" class="form-inline" method="POST">{%csrf_token%}
                <div class="pull-left">
                    <table class="createtable">
                        <tr><th><label for="id_crime_date">Crime date:</label></th><td><input name="crime_date" type="text" id="id_crime_date" /></td><td><font color="red" id="crime_date"></font></td></tr>
                        <tr><th><label for="id_resolve_days">Resolve days:</label></th><td><input name="resolve_days" type="text" id="id_resolve_days" /></td><td><font color="red" id="resolve_days"></font></td></tr>
                        <tr><th><label for="id_num_involved">Num involved:</label></th><td><input name="num_involved" type="text" id="id_num_involved" /></td><td><font color="red" id="num_involved"></font></td></tr>
                        <tr><th><label for="id_creature">Creature:</label></th><td><input name="creature" type="text" id="id_creature" maxlength="45" /></td><td><font color="red" id="creature"></font></td></tr>
                        <tr><th><label for="id_location">Location:</label></th><td><input name="location" type="text" id="id_location" maxlength="45" /></td><td><font color="red" id="location"></font></td></tr>
                        <tr><th><label for="id_trial_location">Trial location:</label></th><td><input name="trial_location" type="text" id="id_trial_location" maxlength="45" /></td><td><font color="red" id="trial_location"></font></td></tr>
                        <tr><th><label for="id_violation_description">Violation description:</label></th><td><textarea name="violation_description" id="id_violation_description" rows=5/></textarea></td><td><font color="red" id="violation_description"></font></td></tr>
                        <tr><th><label for="id_fine">Fine:</label></th><td><input name="fine" type="text" id="id_fine" /></td><td><font color="red" id="fine"></font></td></tr>
                        <tr><th><label for="id_jail_time">Jail time:</label></th><td><input name="jail_time" type="checkbox" id="id_jail_time" /></td><td><font color="red" id="jail_time"></font></td></tr>
                        <tr><th><label for="id_mpa">Mpa:</label></th><td><input name="mpa" type="checkbox" id="id_mpa" /></td><td><font color="red" id="mpa"></font></td></tr>
                    </table>
                </div>
        </div>
        <div class="modal-footer">
            <a href="#" class="btn" data-dismiss="modal">Close</a>
            <button type="submit" class="btn btn-primary" disabled="disabled" id="create_button">Create Report</button>
            </form>
        </div>
    </div>

    <script>
        $(document).ready(function(){
            $( "#datepicker_start, #datepicker_end, #id_crime_date" ).datepicker({format: "yyyy-mm-dd"});
            var reg;
            $('input').change(function() {
                if($('#crime_date').attr('color') != 'green' || $('#resolve_days').attr('color') != 'green' || $('#num_involved').attr('color') != 'green' || $('#creature').attr('color') != 'green' || $('#location').attr('color') != 'green' || $('#trial_location').attr('color') != 'green' || $('#violation_description').attr('color') != 'green' || $('#fine').attr('color') != 'green') 
                    $('#create_button').attr("disabled", "disabled");
                else
                    $('#create_button').removeAttr("disabled", "disabled");
            });
            $('#id_crime_date').keyup(function() {
                reg = /^[0-9]{4}\-[0-9]{2}\-[0-9]{2}$/;
                if(!$('input[id=id_crime_date]').val()){
                    $('#crime_date').empty();
                } else if( ($('input[id=id_crime_date]').val()).match(reg) ){
                    $('#crime_date').attr('color','green');
                    $('#crime_date').html('<b>&#10004;</b>');
                } else {
                    $('#crime_date').attr('color','red');
                    $('#crime_date').html('<b>YYYY-MM-DD</b>');
                }
                $('input').change();
            });
            $('#id_resolve_days').keyup(function() {
                reg = /^[0-9]+$/;
                if(!$('input[id=id_resolve_days]').val()){
                    $('#resolve_days').empty();
                } else if( ($('input[id=id_resolve_days]').val()).match(reg) ){
                    $('#resolve_days').attr('color','green');
                    $('#resolve_days').html('<b>&#10004;</b>');
                } else {
                    $('#resolve_days').attr('color','red');
                    $('#resolve_days').html('<b>Enter Number</b>');
                }
                $('input').change();
            });	
            $('#id_num_involved').keyup(function() {
                reg = /^[0-9]+$/;
                if(!$('input[id=id_num_involved]').val()){
                    $('#num_involved').empty();
                } else if( ($('input[id=id_num_involved]').val()).match(reg) ){
                    $('#num_involved').attr('color','green');
                    $('#num_involved').html('<b>&#10004;</b>');
                } else {
                    $('#num_involved').attr('color','red');
                    $('#num_involved').html('<b>Enter Number</b>');
                }
                $('input').change();
            });	
            $('#id_creature').keyup(function() {
                reg = /^([a-zA-Z]\s?)+$/;
                if(!$('input[id=id_creature]').val()){
                    $('#creature').empty();
                } else if( ($('input[id=id_creature]').val()).match(reg) ){
                    $('#creature').attr('color','green');
                    $('#creature').html('<b>&#10004;</b>');
                } else {
                    $('#creature').attr('color','red');
                    $('#creature').html('<b>Enter Creature</b>');
                }
                $('input').change();
            });		
            $('#id_location').keyup(function() {
                reg = /^\-?[0-9]{1,3}(\.[0-9]{1,3})?,\s?\-?[0-9]{1,3}(\.[0-9]{1,3})?$/;
                if(!$('input[id=id_location]').val()){
                    $('#location').empty();
                } else if( ($('input[id=id_location]').val()).match(reg) ){
                    $('#location').attr('color','green');
                    $('#location').html('<b>&#10004;</b>');
                } else {
                    $('#location').attr('color','red');
                    $('#location').html('<b>Coordinates \n(ex 123.456, -189.012)</b>');
                }
                $('input').change();
            });
            $('#id_trial_location').keyup(function() {
                reg = /^([a-zA-Z]\s?)+$/;
                if(!$('input[id=id_trial_location]').val()){
                    $('#trial_location').empty();
                } else if( ($('input[id=id_trial_location]').val()).match(reg) ){
                    $('#trial_location').attr('color','green');
                    $('#trial_location').html('<b>&#10004;</b>');
                } else {
                    $('#trial_location').attr('color','red');
                    $('#trial_location').html('<b>Enter Location<b>');
                }
                $('input').change();
            });	
            $('#id_violation_description').keyup(function() {
                reg = /^.*$/;
                if(!$('textarea[id=id_violation_description]').val()){
                    $('#violation_description').empty();
                } else if( ($('textarea[id=id_violation_description]').val()).match(reg) ){
                    $('#violation_description').attr('color','green');
                    $('#violation_description').html('<b>&#10004;</b>');
                } else {
                    $('#violation_description').attr('color','red');
                    $('#violation_description').html('<b>Enter Description</b>');
                }
                $('input').change();
            });	
            $('#id_fine').keyup(function() {
                reg = /^\d+$/;
                if(!$('input[id=id_fine]').val()){
                    $('#fine').empty();
                } else if( ($('input[id=id_fine]').val()).match(reg) ){
                    $('#fine').attr('color','green');
                    $('#fine').html('<b>&#10004;</b>');
                } else {
                    $('#fine').attr('color','red');
                    $('#fine').html('<b>Enter Fine Amount<b>');
                }
                $('input').change();	
            });
        });
    </script>

    {% if success %}
        <div id="create_success" class="modal hide fade">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3>Success!</h3>
            </div>
            <div class="modal-body">
                Successfully created Report.
            </div>
            <div class="modal-footer">
                <a href="#" class="btn btn-primary" data-dismiss="modal">Okay</a>
            </div>
        </div>

        <script type="text/javascript">
            $('#create_success').modal({backdrop:false});
        </script>
    {% endif %}

    <div id="edit_report" class="modal hide fade">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h3>Edit Report</h3>
        </div>
        <div class="modal-body">
            <form action="" class="form-inline" method="POST">{% csrf_token %}
                <div class="pull-left">
                    <table class="edittable" style ="text-align:left">
                        <tbody>
                            <tr><th><label for="id_crime_date">Crime date:</label></th><td><input id="id_crime_date" name="crime_date" type="text"></td></tr>
                            <tr><th><label for="id_resolve_days">Resolve days:</label></th><td><input id="id_resolve_days" name="resolve_days" type="text"></td></tr>
                            <tr><th><label for="id_num_involved">Num involved:</label></th><td><input id="id_num_involved" name="num_involved" type="text"></td></tr>
                            <tr><th><label for="id_creature">Creature:</label></th><td><input id="id_creature" maxlength="45" name="creature" type="text"></td></tr>
                            <tr><th><label for="id_location">Location:</label></th><td><input id="id_location" maxlength="45" name="location" type="text"></td></tr>
                            <tr><th><label for="id_trial_location">Trial location:</label></th><td><input id="id_trial_location" maxlength="45" name="trial_location" type="text"></td></tr>
                            <tr><th><label for="id_violation_description">Violation description:</label></th><td><textarea id="id_violation_description" name="violation_description" type="text"></td></tr>
                            <tr><th><label for="id_fine">Fine:</label></th><td><input id="id_fine" name="fine" type="text"></td></tr>
                            <tr><th><label for="id_update_date">Update date:</label></th><td><input id="id_update_date" name="update_date" type="text"></td></tr>
                            <tr><th><label for="id_jail_time">Jail time:</label></th><td><input id="id_jail_time" name="jail_time" type="checkbox"></td></tr>
                            <tr><th><label for="id_mpa">Mpa:</label></th><td><input id="id_mpa" name="mpa" type="checkbox"></td></tr>
                            <tr style="display:none"><th><label for="id_report">Mpa:</label></th><td><input id="id_report" name="report" type="text"></td></tr>
                        </tbody>
                    </table>
                </div>
        </div>
        <div class="modal-footer">
            <a href="#" class="btn" data-dismiss="modal">Close</a>
            <button type="submit" class="btn btn-primary">Update Report</button>
            </form>
        </div>
    </div>

<!--<script type="text/javascript">

        {% block main_javascript %}

        $('.table tr').click(function(){
            $(this);
            $('#edit_report').modal({backdrop:false});
            $('.edittable input#id_report').val($(this).attr('id'));
            $('.edittable input#id_crime_date').val($($(this).find('td')[0]).text());
            $('.edittable input#id_resolve_days').val($($(this).find('td')[1]).text());
            $('.edittable input#id_num_involved').val($($(this).find('td')[2]).text());
            $('.edittable input#id_creature').val($($(this).find('td')[3]).text());
            $('.edittable input#id_location').val($($(this).find('td')[4]).text());
            $('.edittable input#id_trial_location').val($($(this).find('td')[5]).text());
            $('.edittable input#id_violation_description').val($($(this).find('td')[6]).text());
            $('.edittable input#id_fine').val($($(this).find('td')[7]).text());
            $('.edittable input#id_update_date').val($($(this).find('td')[8]).text());
            if($($(this).find('td')[9]).text() == 'True') {
                $(".edittable input#id_jail_time").attr('checked', true);
            }
            else {
                $(".edittable input#id_jail_time").attr('checked', false);
            }
            $('.edittable input#id_jail_time').val($($(this).find('td')[0]).text());
            $('.edittable input#id_mpa').val($($(this).find('td')[0]).text());
        });

        $('#create_report').modal({backdrop:false});
        $('#create_submit').click(function(){$('#invis').submit();});
        $('#create_report').modal('hide');

        {% endblock %}
    </script>
-->
{% endblock %}
		
